# 섭취 제안 로직 가이드

## 📋 개요

섭취 제안 기능은 GL 값에 따라 음식의 안전한 섭취 방법을 제안하는 기능입니다. 사용자가 음식을 섭취하기 전에 혈당 관리에 도움이 되는 맞춤형 조언을 제공합니다.

## 🎯 제안 로직

### 1. GL 10 이하 (안전 - SAFE)

**메시지**: "안심하고 드셔도 좋습니다"

**권장 사항**:
- 표준 섭취량 그대로 섭취 가능
- 추가 제한 없음

**팁**:
- 식이섬유가 풍부한 채소와 함께 섭취
- 단백질이나 지방과 조합하여 섭취하면 혈당 상승을 더욱 완만하게 할 수 있음
- 식후 가벼운 걷기 운동 권장

### 2. GL 11-19 (위험 - MODERATE)

**메시지**: "절반 정도만 드시는 것을 권장합니다"

**권장 사항**:
- 안전한 섭취량 계산 (GL이 10 이하가 되는 양)
- 현재 섭취량의 절반 정도로 조절

**팁**:
- 권장 섭취량 표시 및 적용 버튼 제공
- 채소, 단백질과 함께 드세요
- 식이섬유가 풍부한 채소를 먼저 드시면 혈당 상승을 완만하게 할 수 있음
- 식후 30분 후 가벼운 걷기 운동 권장

### 3. GL 20 이상 (매우 위험 - HIGH_RISK)

**메시지**: "혈당을 크게 올릴 수 있어 주의가 필요합니다"

**권장 사항**:
- 소량만 드시거나 다른 음식을 선택
- 안전한 대체 음식 추천 (같은 카테고리의 저GL 음식)
- 안전한 섭취량 계산 (GL이 10 이하가 되는 양)

**팁**:
- 대체 음식 목록 표시 (같은 카테고리, GL ≤ 10)
- 소량만 드시거나 다른 음식을 선택하세요
- 식이섬유가 풍부한 채소와 함께 소량만 섭취
- 단백질과 지방을 함께 섭취하여 혈당 상승을 완화
- 식후 30분~1시간 후 운동 권장

## 📐 계산 공식

### 안전한 섭취량 계산

```
GL = (GI × (100g당 탄수화물 × 섭취량/100)) / 100
목표 GL = 10
섭취량 = (목표 GL × 10000) / (GI × 100g당 탄수화물)
```

### 예시

- GI: 50
- 100g당 탄수화물: 20g
- 현재 섭취량: 150g
- 현재 GL: (50 × (20 × 150/100)) / 100 = 15

안전한 섭취량 계산:
```
섭취량 = (10 × 10000) / (50 × 20) = 100g
```

## 🎨 UI 구성

### 메시지 카드
- 경고 레벨에 따른 색상 (초록/노랑/빨강)
- 아이콘 표시 (체크/경고/에러)
- 메인 메시지

### 권장 섭취량 카드 (위험/매우 위험)
- 권장 섭취량 표시
- 현재 섭취량과 비교
- "적용" 버튼으로 슬라이더 값 변경

### 대체 음식 카드 (매우 위험)
- 같은 카테고리의 저GL 음식 목록
- 가로 스크롤 가능
- 각 음식의 GL 값 표시
- 클릭 시 해당 음식의 GL 계산 화면으로 이동

### 팁 카드
- 섭취 팁 목록
- 체크 아이콘과 함께 표시
- 경고 레벨에 따른 맞춤 팁

## 🔧 구현 세부사항

### 파일 구조

```
src/
├── utils/
│   └── foodRecommendation.ts      # 제안 로직 유틸리티
├── components/
│   └── ConsumptionRecommendation.tsx  # 제안 UI 컴포넌트
└── screens/
    └── GLCalculationScreen.tsx    # GL 계산 화면 (통합)
```

### 주요 함수

#### `generateConsumptionRecommendation()`
- 음식 정보와 현재 섭취량을 받아 제안 생성
- GL 값에 따라 다른 제안 반환

#### `calculateSafeServingSize()`
- 목표 GL(기본 10)에 맞는 안전한 섭취량 계산
- 10g 단위로 반올림

#### `findAlternativeFoods()`
- 같은 카테고리의 저GL 음식 찾기
- GL ≤ 10인 음식만 추천
- GL 값 오름차순 정렬

## 🚀 사용 방법

### GLCalculationScreen에서 자동 표시

GL 계산 화면에서 섭취량을 조절하면 자동으로 제안이 업데이트됩니다:

```typescript
// GLCalculationScreen.tsx에서 자동으로 처리됨
const recommendation = generateConsumptionRecommendation(
  food,
  servingSize,
  allFoods, // 대체 음식 추천용
);
```

### 수동 사용

```typescript
import {generateConsumptionRecommendation} from '../utils/foodRecommendation';

const recommendation = generateConsumptionRecommendation(
  foodItem,
  currentServingSize,
  allFoods, // 선택사항
);
```

## 📊 데이터 흐름

1. **GL 계산**
   - 섭취량 변경 → GL 재계산

2. **제안 생성**
   - GL 값 확인 → 안전도 레벨 판단
   - 레벨에 따라 제안 생성

3. **UI 업데이트**
   - 제안 데이터 → ConsumptionRecommendation 컴포넌트
   - 사용자에게 표시

4. **사용자 액션**
   - 권장 섭취량 적용 → 슬라이더 값 변경
   - 대체 음식 선택 → 해당 음식의 GL 계산 화면으로 이동

## 🎯 향후 개선 사항

- [ ] 사용자 프로필 기반 맞춤 제안 (당뇨 타입별)
- [ ] 식사 조합 제안 (여러 음식 조합)
- [ ] 운동 강도 및 시간 제안
- [ ] 시간대별 섭취 제안 (아침/점심/저녁)
- [ ] 개인 건강 데이터 연동 (혈당 측정기)

## 📝 주의사항

1. **대체 음식 데이터**
   - 현재는 Redux store의 데이터 사용
   - 실제 구현 시 데이터베이스에서 전체 음식 목록 가져오기 권장

2. **안전한 섭취량 계산**
   - 10g 단위로 반올림하여 표시
   - 최소 10g, 최대 500g 범위 내에서 제한

3. **의료 조언 아님**
   - 이 제안은 참고용이며 의료 조언이 아닙니다
   - 실제 섭취 시 의사와 상담 권장

## 📞 문의

섭취 제안 기능 관련 문의사항이 있으시면 이슈를 생성해주세요.

